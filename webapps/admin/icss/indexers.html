<div class="inbox-nav-bar no-content-padding"></div>


<div id="inbox-content" class="inbox-body no-content-padding">


	<div class="inbox-side-bar">
		<div class="well">Choose Indexer
			<select class="input-sm" id="indexers">
			</select>
		</div>
		
		<ul class="inbox-menu-lg">
			<li class="submenu active"><a class="overview-load" href="javascript:void(0);"> Overview </a></li>
			<li class="submenu"><a class="defined-load" href="javascript:void(0);">Define Indexer</a></li>
			<li class="submenu"><a class="schema-load" href="javascript:void(0);">Schema</a></li>
			<li class="submenu"><a class="index-load" href="javascript:void(0);">Index</a></li>

			<li class="submenu"><a class="query-load" href="javascript:void(0);">Query</a></li>
			<li class="submenu"><a class="browsing-load" href="javascript:void(0);">Browsing</a></li>
		</ul>
		

		<div class="air air-bottom inbox-space">
			FileSize : <strong>1G</strong><br>
			DocCount : <strong>100</strong><a href="javascript:void(0);" rel="tooltip" title="" data-placement="top" data-original-title="Empty Spam" class="pull-right txt-color-darken"><i class="fa fa-trash-o fa-lg"></i></a>
			<div class="progress progress-micro">
				<div class="progress-bar progress-primary" style="width: 0%;"></div>
			</div>
		</div>

	</div>


	<div class="table-wrap custom-scroll animated fast fadeInRight">
		<!-- ajax will fill this area -->
		LOADING...

	</div>


</div>

<div id="new-indexer-confirm" title="Create Indexer" style="display:none">
	<form class="smart-form" id="new-indexer-form" method="post" action="indexers/" novalidate="novalidate">
		<fieldset style="padding: 0px">	
			<section>
				<label class="label">Indexer ID</label>
				<label class="input">
					<input type="text" id="newId" name="iid" placeholder="new indexer id" />
				</label>
			</section>
		</fieldset>
	</form>
</div>

<div id="create_schema_form" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
       <div class="modal-content">
        	
            <div class="modal-header"><h5 id="myModalLabel">Create Schema</h5></div>

            <div class="modal-body">
		<form class="smart-form" method="post" action="indexers/schema" novalidate="novalidate">
		<fieldset style="padding: 0px">					
			<section>
				<label class="label">Schema Id</label>
				<label class="input">
					<input type="text" id="schemaid" name="schemaid"/>
				</label>
			</section>
			<section>
				<label class="label">Schema Type</label>
				<label class="select">
					<select name="schematype" id="schematype">
					    <option value="text" selected="selected">Text</option>
					    <option value="keyword">Keyword</option>
					    <option value="number">Number</option>
					    <option value="date">Date</option>
					    <option value="manual">Manual</option>
					</select>
				</label>
			</section>
			<div class="row" id="schema_option" style="display:none">
			<section class="col col-6">
				<label class="checkbox"><input type="checkbox" id="schema_analyze" name="analyze" checked="false" /><i></i>Analyze</label>
			</section>
			<section class="col col-6">
				<label class="checkbox"><input type="checkbox" id="schema_store" name="store" checked="false" /><i></i>Store</label>
			</section>
			</div>
			<section>
				<label class="label">Boost</label>
				<label class="input">
					<input type="text" id="boost" name="boost" placeholder="1.0"/>
				</label>
			</section>

		</fieldset>
		</form>
            </div>
            
            <div class="modal-footer">
              <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
              <button class="btn btn-primary" id="btn_create_schema">Create Schema</button>
            </div>  

       </div>
	</div>
</div>

<script type="text/javascript">

	pageSetUp();

	// PAGE RELATED SCRIPTS

	// pagefunction
	var pagefunction = function() {

		$("#btn_create_schema").click(function(){
			
			var iid = $("#indexers").val() ;
			
			$.ajax({
				type: "POST",
				url: "/admin/indexers/" + iid + "/schema",
				data: { schemaid: $("#create_schema_form input[name=schemaid]").val(), schematype: $("#create_schema_form select[name=schematype]").val(),  analyze: $("#create_schema_form input[name=analyze]").is(":checked") ? true : false, store: $("#create_schema_form input[name=store]").is(":checked") ? true : false, boost:$("#create_schema_form input[name=boost]").val() }
			}).done(function( msg ) {
				console.log( "Data Saved: " + msg );
			}).success(function( msg ) {
				$("#create_schema_form").modal('hide') ;
				loadURL("icss/indexers/schema.html", $('#inbox-content > .table-wrap')) ;
			});
			
		});

		// fix table height
		tableHeightSize();

		$(window).resize(function() {
			tableHeightSize() ;
		})
		function tableHeightSize() {
			if ($('body').hasClass('menu-on-top')) {
				var menuHeight = 68;
				// nav height

				var tableHeight = ($(window).height() - 224) - menuHeight;
				if (tableHeight < (320 - menuHeight)) {
					$('.table-wrap').css('height', (320 - menuHeight) + 'px');
				} else {
					$('.table-wrap').css('height', tableHeight + 'px');
				}

			} else {
				var tableHeight = $(window).height() - 224;
				if (tableHeight < 320) {
					$('.table-wrap').css('height', 320 + 'px');
				} else {
					$('.table-wrap').css('height', tableHeight + 'px');
				}

			}

		}
		
		var lastColId = '' ;
		$.ajax({
			url:'/admin/indexers',
			dataType:'json',
			success:function(data){
				for(var idx in data){
					var col = data[idx] ;
					var option = $('<option value="'+col['iid']+'">'+col['name']+'</option>') ;
					option.appendTo($("#indexers")) ;
				}
				$("#indexers option:eq(0)").attr("selected", "selected");
				$('<option value="-new">.Create Indexer</option>').appendTo($("#indexers")) ;
				
				//LOAD INBOX MESSAGES
				loadURL("icss/indexers/overview.html", $('#inbox-content > .table-wrap')) ;
				lastColId = $("#indexers").val() ;
				
			}, 
			error:function(request,status,error){
				console.log('response', request, status, error) ;
			}
		}) ;

		$("#indexers").change(function(){
			if ($(this).val() == '-new'){
				$(function() {
				$( "#new-indexer-confirm" ).css('visibility', 'visible') ;
				$( "#new-indexer-confirm" ).dialog({
					modal: true,
					buttons: {
						"Create Indexer": function() {
							var newId = $("#newId").val() ;
							var win = $( this ) ;
							if (newId > ' '){
								$.ajax({
									type: "POST",
									dataType : 'text', 
									url: "/admin/indexers/" + newId,
									data: { }, 
									complete : function(){ 
										// $("#query_url").text(this.url) ;
									}, 
									success :  function(data) {
										$("#indexers option:eq(0)").after('<option value="'+newId+'" selected="selected">'+newId+'</option>');
										loadURL("icss/indexers/overview.html", $('#inbox-content > .table-wrap')) ;
										win.dialog( "close" );
									}
								}) ;	
							}
							},
						Cancel: function() {
							$(this).dialog( "close" );
						}}
					});
				});
				if (lastColId > ' ') { $("#indexers option[value='" + lastColId + "']").attr('selected', 'selected');  }
				
			} else {
				lastColId = $(this).val() ;
				loadURL("icss/indexers/overview.html", $('#inbox-content > .table-wrap')) ;
			}
		}) ;
		

		$("#schematype").change(function(){
			if ($("#schematype").val() == 'manual') {
				$("#schema_option").show() ;
			} else {
				$("#schema_option").hide() ;
			}
		}) ;

		$("li.submenu").click(function() {
		    $(this).toggleClass("active");
		    $(this).siblings().removeClass("active");
		});

		// Buttons (compose mail and inbox load)
		$(".overview-load").click(function() {
			loadURL("icss/indexers/overview.html", $('#inbox-content > .table-wrap'))
		});
		$(".defined-load").click(function() {
			loadURL("icss/indexers/defined.html", $('#inbox-content > .table-wrap')) ;
		});
		$(".analysis-load").click(function() {
			loadURL("icss/indexers/analysis.html", $('#inbox-content > .table-wrap')) ;
		});
		$(".schema-load").click(function() {
			loadURL("icss/indexers/schema.html", $('#inbox-content > .table-wrap')) ;
		});
		$(".index-load").click(function() {
			loadURL("icss/indexers/index.html", $('#inbox-content > .table-wrap')) ;
		});
		$(".query-load").click(function() {
			loadURL("icss/indexers/query.html", $('#inbox-content > .table-wrap')) ;
		});
		$(".browsing-load").click(function() {
			loadURL("icss/indexers/browsing.html", $('#inbox-content > .table-wrap')) ;
		});
	
	};

	pagefunction();
	
</script>
